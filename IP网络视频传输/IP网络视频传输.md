近年来，随着网络技术的发展，以及视频采集、数字化和压缩的视频处理技术持续不断的升级迭代，网络传输内容从以前的单一文本向图像、语音、视频等多方面发展。而对于网络视频，最看重的就是视频传输量、传输方式和传输范围。



## IP 网络

首先简单介绍下**三网融合**的概念。

**三网融合**所指的三种通信网分别是公共电信网、计算机网和广播电视网，这三种网络和视频传输密切相关。

**（1）公共电信网**

公共电信网长期以来的主体业务是电话通信，其终端设备主要是普通模拟电话机，语音信息可通过传输线路和交换设备进行互传。如今电话网的主要设备已经从模拟电话机变为了数字传输设备和数字交换设备，使其成为一个以数字通信为主体的网络。

初期，在传输中占比最大的用户线路上传输的是模拟语音信息，这给传输数字信息带来了一定的难度，为了解决这个问题，当时采用了非对称数字用户线（ADSL）技术提供数据接入方式，它不需要对现有的电信网络进行改造，只需要在接入端接入一个调制调节器，即可同时提供准宽带数据服务和传统语音服务。

而如今，用户光纤到家（FTTH）的方式已经逐步取代了 ADSL。在光纤的支持下，可以传输宽带视频信号了，而电话业务也只是夹带在用户宽带光纤中的一小部分数据。

**（2）计算机网**

在计算机通信网中，主要有局域网（LAN）、广域网（WAN）、城域网（MAN）以及互联网（Internet）。在这些网络中，局域网是最基础的网络，其余的网络都是由若干局域网通过骨干网及相关的通信协议互联而成的。

**（3）广播电视网**

早期的模拟广播电视功能单一，仅通过无线方式单向传播，向用户提供电视节目，甚至谈不上“网”的概念。后来，广播电视逐渐向有线电视发展，但主要还是以单向，树形网络方式连接到终端，虽然改进了收视质量，但用户只能选择被动的接收。而近年来，经过数字化和宽带化等改造，广播电视已经成为以传送数字电视为主要业务的现代数字通信网。其普及率高、接入带宽较大，且运营商掌握大量的视频资源。现在，广播电视网的目标是将现有的电视网全面改造成双向交互式的 IP 网络，可以传输各种媒体信息。



**三网融合**是近年来才兴起的一种概念，指的是公共电信网、广播电视网和互联网在发展过程中，技术功能逐渐趋于一致，业务范围趋于相同，实现三网互联互通，资源共享，为用户提供数据、音频和视频等多种媒体服务。

而要实现三网的互联互通，就需要通过 IP 技术在内容与传输介质之间搭起一座桥梁，也就是说，三种网络都必须支持 IP 技术，即 IPv4 和 IPv6。只有都采用了 IP 技术，才能保证各种以 IP 为基础的业务能够在不同的网络之间实现互通。从某种意义上来说，这三个网络融合为了一个 IP 网络。

IP 网络使得各种文本、语音、数据、图像和视频都可以通过统一的编码进行传输，所有的业务在 IP 网络中都将成为统一的 0 或 1 的比特流。**三网融合**并不意味着三种网络的物理合一，而主要是指高层业务应用的融合。在这些业务中，流媒体业务是非常重要的一个部分，其使用流媒体化技术进行网络流媒体的传输，视频媒体流就是网络流媒体的一部分，它是基于应用层协议的，而传统的流媒体技术一般是基于网络传输层协议的。



## 流媒体

流媒体是指将一连串的媒体数据包从服务器端发送到客户端，可以实现边下边播，此技术使得数据包可以像流水一样发送。

传统的方式是先下载整个视频文件，下载完成存储到本地后，用户可以自行选择播放，但是如果仅仅是为了观看视频的内容，那么完全不必等到整个视频文件下载完成，而是采用**流水**的方式，将视频流不断地传输到客户端，等到有一定视频流数据后，就可以选择开始播放，然后边播放边继续传输，再将观看过的部分数据丢弃。这种方式不仅降低了对用户存储容量的要求，也大大缩短了用户等待观看的时间。

流媒体技术不是一种单一的技术，它是将网络技术、音视频技术还有终端缓存技术等结合起来。也就是说，在网络上要实现流媒体技术，必须要先制作、发布、传输和播放等，还需要服务器端、终端以及网络的支持。可以分为以下几个部分：

- 内容的产生：主要是将视频源制作成为可以对外发布的视频格式，以及适合在网络上传播的分辨率和码率。
- 对外发布：主要是指能够支撑服务器对外输出视频资源的技术，常见的有各种流媒体网络传输协议技术及其需要服务器端支撑的技术。
- 传输方式：传输视频流还得考虑一个问题，是服务器对外主动推数据，还是等待终端到服务器端拉数据，这是两个完全相反的处理方式。对于组播或者广播的组网方式，往往采用的是服务器主动对外推送数据；而对于单播来说主要是终端向服务器端主动拉数据。
- 传输协议：应用层常见的是 RTP 和 HTTP，传输层则主要是 TCP 和 UDP。
- 视频播放：主要指的终端，在不同操作系统中能够进行播放视频的播放器，不同的播放器支持对不同类型的视频数据进行播放。

流式传输主要包括两种实现方式：顺序流式传输（Progressive Streaming）和实时流式传输（Real Tme Streaming）。

**（1）顺序流式传输**

在顺序流式传输模式下，用户在观看在线媒体的同时，同时也在下载文件。在这个过程中，用户只能观看已经下载完成的媒体内容，而不能直接观看未下载的部分。因此，用户会在一段延时后，才能看到服务器传送过来的媒体内容。由于标准的 HTTP 服务器就可以发送这种形式的媒体文件，因此流式传输也经常被称为 HTTP 流式传输。

由于顺序流式传输能够较好地保证节目的播放质量，因此比较适合在网站上发布的、可供用户点播的、高质量的视频。顺序流式传输的文件一般存放在标准 HTTP 或 FTP 服务器上，易于管理。

**（2）实时流式传输**

使用实时流式传输时，必须要保证与流媒体对应的带宽，以使媒体内容可以被用户实时观看到。用户在观看过程中，可以任意观看当前媒体内容之前或后面的内容。但是在这种传输方式中，如果网络状况太差，可能会导致收到的图像质量比较差。

实时流式传输需要特定的服务器，例如 Windows Media Server，这些服务器可以对媒体进行更多的控制，所以其设置与管理比标准 HTTP 服务器要更加复杂。

实时流式传输还需要特殊的网络协议，如 RTSP 等。而且防火墙有时会对这些协议进行屏蔽，导致用户看不到不实时内容。



## 传输方式

近几十年来，互联网中的数据越来越多，互联网档案馆存储这约 2PB 的数据，并以每月至少 20TB 的速度增加；而 Youtube 视频网站每天都会上传约 10TB 的视频数据，这些导致现今网络中存储的电子数据总量很难估算。而其中文件、图片、视频等非结构化信息约占总数据量的 90%。

随着互联网中各种视频服务的海量视频数据的涌现，这些服务对网络数据传输中的信息安全、网络带宽、传播效率等提出了更高的要求。而在 IP 网络传输中，有 3 种适应不同环境的数据包发送方式：单播、广播和组播。

**（1）单播**

在单播方式中，系统为每个请求该信息的用户单独建立一条数据传送通路，在发送者和每个接收者之间实现点对点的网络连接，并为该用户发送一份独立的复制信息。如果一个发送者同时给多个接收者传输相同的数据，那么就必须建立多个连接，并且复制多份相同的数据包进行发送。如果有大量接收者希望获得数据包的同一份复制时，将会导致发送者负担加重、延迟增加、甚至网络拥塞等。

**（2）广播**

在广播方式中，发送者把同一信息传送给网络中的所有用户，即在 IP 子网内广播数据包，不管是否需要，所有在子网内部的用户都会接收到这些数据包。一般广播的使用范围非常小，通过路由器和交换机控制广播传输，只在本地子网内有效。

**（3）组播**

在组播方式中，在发送者和每个接收者之间实现一对多的网络连接。借助组播路由协议为组播数据包建立组播分发树，被传递的信息在距离用户端尽可能近的节点才开始复制和分发。如果一个发送者同时给多个接收者传输相同的数据，也只需复制一份相同的数据包。它提高了数据传送效率，减少了骨干网络出现拥塞的可能性。组播方式适用于网络中需求某信息的用户量不确定时。

组播与广播有些类似，其是一种效率更高的广播。组播与广播消息最主要的区别在于，组播数据流的接收方可以位于不同的网段中，而不用位于相同的网段中。网络设备在接收到一个数据包后将其复制，然后把复制数据包从更多个网络接口发送出去。



举个例子，如果使用单播的话，就需要网络上所有有兴趣收听广播电台的设备上都建立一条独立的会话。如图所示，有 1 个发送方和 3 个接收方。发送方是生成信息的设备，并且把信息通告到一个组中，接收方是收听这个信息的设备。

<img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h3nqxjv6qbj20jg09vaac.jpg" alt="单播" style="zoom:75%;" />

由于每条数据流都是复制来的，因此发送方必须为每个客户端复制同样的信息，这些网络连接也会占用 3 倍的带宽。如果只建立低带宽音频会话，并且只有 3 个用户的话，这倒不是什么大问题。但如果是需要建立上万条或者数百万条会话的情况，为每个客户端复制信息的行为会大大消耗网络资源。

而此时使用广播的话，发送方要连接的会话数量会大大减少，这也就减少了发送方占用的网络带宽。但是在这种情况中，复制数量庞大的数据流所带来的问题消除了，带宽利用率问题解决了，但发送方又面临了另一个难题，但现在所有设备都会收到发送方发送的消息，无论数据是否是发送给他们的。当发送方的数量增加时，网络中的每个接收方都会收到越来多的可能并不希望收到的信息。所以所有接收方必须对广播数据进行处理，来判断这是不是与自己相关的信息。

<img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h3nqxz9ja2j20jg09zdg3.jpg" alt="广播" style="zoom:75%;" />

组播就可以解决上面这些问题，既能够将发送方需要发送的会话数量降到最低，也能够降低网络负载，从发送诸多条数据流，到只发送一条数据流。同时我们也能保留单播提供的优势，就是只把广播电台数据包发送给想要收听的设备。下图描绘了组播的方式，发送方只发送一条数据流，并且这条数据流只会被复制给感兴趣的接收方。

<img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h3nqy3mwpvj20jg09z0t1.jpg" alt="组播" style="zoom:75%;" />



## 传输协议

在 IP 网络中，主要采用 TCP/IP 族规范网络的信息传输。采用 TCP/IP 族的 IP 网络可使用 4 层结构表示。如图所示，从高层到底层分别是应用层、传输层、网络层和网络接口层。在 TCP/IP 模型的每一层都有若干协议，图中给出和主流多媒体传输关系较大的几个协议，它们基本处于传输层和应用层。其中，应用层常见的有 RTP、RTCP、RTSP、RTMP、 HTTP 等，而传输层主要是 TCP 和 UDP。

在应用层之上的就是视频传输协议了，从图中可以看到它们其实是有基于的关系，比如 HLS 协议是基于 HTTP 进行传输，而 HTTP 在传输层都是依赖 TCP 数据包，再经由 IP 层进行分发。

<img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h3nqygw9e6j21fc0sgjto.jpg" alt="架构" style="zoom: 33%;" />

**（1）RTP 系列协议**

实时传输协议（RTP），其主要用于说明传递音频和视频的标准数据包的格式。RTP 是创建在 UDP 协议之上的，主要应用于流媒体、视频会议等系统业务上。RTP 为端到端的数据传输提供了时间信息和流同步，但不保证服务质量，而是由 RTCP 保证服务质量。

实时传输控制协议（RTCP），主要负责媒体数据的传输。实时传输控制协议是为了配合 RTP 使用而制定的。在通常情况下，二者都是基于 UDP 的协议传输。RTP 本身并不能为传送的数据包提供可靠的传送机制，也不提供流量控制或拥塞控制，它依靠 RTCP 提供这些服务。

实时流协议（RTSP）虽然是应用层协议，但从细分的角度来看，它位于 RTP 和 RTCP 之上，作为实时流媒体数据在网络上传送的控制协议，负责对流媒体服务器和客户端之间会话的建立、交互以及拆除链接等协商控制。RTSP 本身并不传输流媒体数据，必须依赖于下层传输协议提供的这些服务，如 RTP 的流媒体数据传送服务。RTSP 负责定义具体的控制消息、操作方式等，通过与 RTP/RTCP 配合使用，交互操作，可以实现对流媒体提供诸如播放、暂停、快进等操作。

简言之，在流媒体数据的传输过程中，一般采用 RTP 封装实时流媒体数据，提供解码所需要的时间戳和编码类型等信息；用 RTCP 提供流量控制、拥塞控制和反馈网络传输状况；用 RTSP 控制具有实时特性的流媒体数据传输。

**（2）HTTP** 

位于应用层的超文本传输协议是互联网上应用最为广泛的一种网络协议，由万维网协会和互联网工程任务组共同开发。HTTP 最初的设计目的是为了提供一种发布和接收超文本标记语言（HTML）页面的方法，所有的 Web 文件都必须遵守这个标准。后来，由于 HTTP 的普及和便利，人们也开始利用 HTTP 传输多媒体数据。

HTTP是一个无状态的协议，服务器对以前的信息处理没有记忆能力，不会记住客户端的状态。每个 HTTP 请求都是在一段时间内的会话中独立处理，不需要查找先前信息，所以它的应答较快。如果 HTTP 客户端请求数据，服务器端会及时响应。HTTP 使用传输层 TCP 作为数据包的承载，具有较高的媒体数据传送可靠性，但难以保证吞吐量和实时性。HTTP 的无状态特性和 TCP 的非实时性在媒体流传输上显然存在较大的不足之处，这也是后来基于 HTTP 的动态自适应流（DASH）传输方式的重点改进之处。



## HTTP 自适应视频流传输

动态自适应控制的 HTTP 视频流传输实际上是在上述 HTTP 逐渐下载方式的基础上发展起来的。 以 HTTP 为基础的自适应流媒体传输的好处是使用已有的 HTTP 而不是开发一个新的传输协议。这种技术能够实现持续一系列小片数据的下载，而不是一个大文件的连续下载。在这种以 HTTP 为基础的自适应流媒体传输方案中，将压缩视频数据切割成许多小的数据片，这些小的数据片通常是 2~10 秒，正好是一个 GOP 的大小，每个数据片中有一个关键帧，且每个数据片的解码都是独立的，不依靠其他的数据片。

为了动态地适应网络状态，服务器往往从同一个源产生多个不同码率的节目流以适应不同的带宽和不同的设备类型，而且分发这一系列的文件以及码流传输的变化都是适应有效网络吞吐量和可用的 CPU 资源。另外，所有的控制操作都是由用户发起的，对用户是透明的，视频流的切换都在后台进行，用户很难注意到视频流的变化。

动态自适应视频流 HTTP 传输相对于传统流媒体传输具有以下优点。

- 能够充分利用广泛存在的 HTTP 网络环境，实施容易，成本低。
- 能够做到实时传送，支持直播。
- 能够让观众控制收视质量，可平滑地在不同码率间切换， 不需要服务器端干预。
- 能够使观众感到在播放中几乎没有缓冲等待、链接中断和回放停顿等问题。

